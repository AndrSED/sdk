test_response = {
    'el-dev-101-ea_imp-30m': 100.123,
    'el-dev-101-ea_exp-30m': 200.123,
    'el-dev-102-ea_imp-30m': 300.123,
    'el-dev-102-ea_exp-30m': 400.123,
}

raw_data = [{'channel': 'el-dev-101-ea_imp-30m',
             'data': [{'dt': '2023-03-01 00:00:00', 'v': 3.729}, {'dt': '2023-03-01 00:30:00', 'v': 3.5825},
                      {'dt': '2023-03-01 01:00:00', 'v': 3.634}, {'dt': '2023-03-01 01:30:00', 'v': 3.6470000000000002},
                      {'dt': '2023-03-01 02:00:00', 'v': 3.6385}, {'dt': '2023-03-01 02:30:00', 'v': 3.634},
                      {'dt': '2023-03-01 03:00:00', 'v': 3.6270000000000002},
                      {'dt': '2023-03-01 03:30:00', 'v': 3.6805},
                      {'dt': '2023-03-01 04:00:00', 'v': 3.6165000000000003},
                      {'dt': '2023-03-01 04:30:00', 'v': 3.6275}, {'dt': '2023-03-01 05:00:00', 'v': 2.908},
                      {'dt': '2023-03-01 05:30:00', 'v': 2.9435000000000002}, {'dt': '2023-03-01 06:00:00', 'v': 2.857},
                      {'dt': '2023-03-01 06:30:00', 'v': 2.944}, {'dt': '2023-03-01 07:00:00', 'v': 3.4025},
                      {'dt': '2023-03-01 07:30:00', 'v': 5.529}, {'dt': '2023-03-01 08:00:00', 'v': 9.5185},
                      {'dt': '2023-03-01 08:30:00', 'v': 3.9445}, {'dt': '2023-03-01 09:00:00', 'v': 3.874},
                      {'dt': '2023-03-01 09:30:00', 'v': 3.745}, {'dt': '2023-03-01 10:00:00', 'v': 4.117},
                      {'dt': '2023-03-01 10:30:00', 'v': 3.7855}, {'dt': '2023-03-01 11:00:00', 'v': 3.952},
                      {'dt': '2023-03-01 11:30:00', 'v': 3.7205}, {'dt': '2023-03-01 12:00:00', 'v': 9.6295},
                      {'dt': '2023-03-01 12:30:00', 'v': 9.299}, {'dt': '2023-03-01 13:00:00', 'v': 9.324},
                      {'dt': '2023-03-01 13:30:00', 'v': 8.976}, {'dt': '2023-03-01 14:00:00', 'v': 9.1355},
                      {'dt': '2023-03-01 14:30:00', 'v': 4.3615}, {'dt': '2023-03-01 15:00:00', 'v': 4.522},
                      {'dt': '2023-03-01 15:30:00', 'v': 3.9805}, {'dt': '2023-03-01 16:00:00', 'v': 4.1025},
                      {'dt': '2023-03-01 16:30:00', 'v': 4.0305}, {'dt': '2023-03-01 17:00:00', 'v': 3.895},
                      {'dt': '2023-03-01 17:30:00', 'v': 3.943}, {'dt': '2023-03-01 18:00:00', 'v': 3.9365},
                      {'dt': '2023-03-01 18:30:00', 'v': 3.6735}, {'dt': '2023-03-01 19:00:00', 'v': 4.011},
                      {'dt': '2023-03-01 19:30:00', 'v': 3.6485}, {'dt': '2023-03-01 20:00:00', 'v': 3.5735},
                      {'dt': '2023-03-01 20:30:00', 'v': 3.6}, {'dt': '2023-03-01 21:00:00', 'v': 3.6475},
                      {'dt': '2023-03-01 21:30:00', 'v': 3.614}, {'dt': '2023-03-01 22:00:00', 'v': 3.5615},
                      {'dt': '2023-03-01 22:30:00', 'v': 3.6345}, {'dt': '2023-03-01 23:00:00', 'v': 3.6685},
                      {'dt': '2023-03-01 23:30:00', 'v': 3.697}]}]

sum_energy = {}
for chanel in raw_data:
    dev, _, side = chanel['channel'].lstrip('el-dev-').rstrip('-30m').partition('-')
    total = sum([x['v'] for x in chanel['data']])
    if sum_energy.get(dev):
        if side == 'ea_imp':
            sum_energy[dev] = sum_energy[dev] + total
        elif side == 'ea_exp':
            sum_energy[dev] = sum_energy[dev] - total
        else:
            print(f'Ошибка приёма ')
    else:
        if side == 'ea_imp':
            sum_energy[dev] = total
        elif side == 'ea_exp':
            sum_energy[dev] = -(total)
        else:
            print(f'Ошибка приёма ')


print(sum_energy)
# ttt = {
#     101: 100.123,
#     102: 200.123,
#     103: 300.123,
#     104: 400.123,
# }
# sum = {}
# for name, val in test_response.items():
#     dev, _, side = name.lstrip('el-dev-').rstrip('-30m').partition('-')
#     if sum.get(dev):
#         if side == 'ea_imp':
#             sum[dev] = sum[dev] - val
#         elif side == 'ea_exp':
#             sum[dev] = sum[dev] + val
#         else:
#             print(f'Ошибка приёма ')
#     else:
#         if side == 'ea_imp':
#             sum[dev] = -(val)
#         elif side == 'ea_exp':
#             sum[dev] = val
#         else:
#             print(f'Ошибка приёма ')
#
# print(sum)
#
# rr = 'el-dev-101-ea_imp-30m'
#
# print(rr.lstrip('el-dev-').rstrip('-30m'))
# dev, _, side = rr.lstrip('el-dev-').rstrip('-30m').partition('-')
#
# print(dev, side)
